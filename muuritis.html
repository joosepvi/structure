<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Müüritise kandevõime</title>
	<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
	<script id="MathJax-script" async
		src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
	</script>
	<script type="text/javascript">

		function calculateMasonryCompressiveStrength(kFactor, brickStrength, mortarStrength) {
			// Calculate compressive strength of masonry in N/mm^2
			return kFactor * Math.pow(brickStrength, 0.7) * Math.pow(mortarStrength, 0.3);
		}

		function calculateMomentFromLoad(load, eccentricity) {
			// Calculate the moment at the top of the wall from the point load in kNm
			return load*eccentricity;
		}

		function calculateMomentFromWindLoad(windLoad, height) {
			// Calculate the moment in the middle of the wall from the wind load in kNm
			return -windLoad*height*height/8;
		}

		function calculateEccentricityAccidental(height) {
			return height/300;
		}

		function calculateEccentricityCreep(height, thickness, eccentricityInitialMid, eccentricityAccidental) {
			const creepFactor = 1.0;
			return 0.002 * creepFactor * (height/thickness) * Math.sqrt(thickness*(eccentricityInitialMid+eccentricityAccidental));
		}

		function calculateStructuralResistanceLoad(load, windLoad, eccentricity, thickness, height, width, masonryStrength) {
			const h = height; // Height of wall in meters
			const b = width; // Width of wall in meters
			const t = thickness; // Thickness of the wall in meters
			const fM = masonryStrength;
			const hEff = h; // Effective height of wall (fixed to height of wall)

			// Calculate accidental eccentricity
			const eccentricityAccidental = calculateEccentricityAccidental(hEff);

			// Calculate bending moment
			const mEdTop = calculateMomentFromLoad(load, eccentricity); // Bending moment at the top of the wall in kNm
			const mEdWind = calculateMomentFromWindLoad(windLoad, h); // Maximum bending moment from the wind load
			const mEdMid = 0.6 * mEdTop + mEdWind; // Max bending moment near the center of the wall in kNm

			// Calculate eccentricity
			const eccentricityInitialMid = Math.abs(mEdMid/load);
			const eccentricityCreep = calculateEccentricityCreep(hEff, thickness, eccentricityInitialMid, eccentricityAccidental);


			// Calculate the compression area of the wall
			const eccentricityTop = eccentricity + eccentricityAccidental;
			const eccentricityMid = eccentricityInitialMid + eccentricityAccidental + eccentricityCreep;
			const AcTop = b * (t - 2 * eccentricityTop); // at the top
			const AcMid = b * (t - 2 * eccentricityMid); // near the center

			// Calculate the slenderness reduction factor
			const slenderness = h/t;
			const u = (slenderness - 2) / (23 - 37 * eccentricityMid/thickness);
			const chi = Math.pow(Math.E, -u*u/2);

			// Calculate axial load resistance
			const nRdTop = fM/1.7 * AcTop * 1000; // Axial load resistance at the top in kN
			const nRdMid = chi * fM/1.7 * AcMid * 1000; // Axial load resistance near the middle in kN


			document.getElementById("vahetulemused").innerHTML = `e_mTop = ${eccentricity} m <br>
				e_mMid = ${eccentricityInitialMid} m <br>
				e_a = ${eccentricityAccidental} m <br>
				e_k = ${eccentricityCreep} m <br>
				e_Top = ${eccentricityTop} m <br>
				e_Mid = ${eccentricityMid} m <br>
				A_cTop = ${AcTop} m2 <br>
				A_cMid = ${AcMid} m2 <br>
				lambda = ${slenderness} <br>
				chi = ${chi} <br>
				N_RdTop = ${nRdTop} kN <br>
				N_RdMid = ${nRdMid} kN <br>`;



			//return AcMid;
			return Math.min(nRdTop, nRdMid);
		}


		function updateResult() {
		  const load = parseFloat(document.getElementById("load").value);
		  const windLoad = parseFloat(document.getElementById("windLoad").value);
		  const eccentricity = parseFloat(document.getElementById("eccentricity").value);
		  const height = parseFloat(document.getElementById("height").value);
		  const width = parseFloat(document.getElementById("width").value);
		  const thickness = parseFloat(document.getElementById("thickness").value);
		  const brickStrength = parseFloat(document.getElementById("brick-strength").value);
		  const mortarStrength = parseFloat(document.getElementById("mortar-strength").value);
		  const kFactor = parseFloat(document.getElementById("k-factor").value);

		  const masonryCharacteristicStrength = calculateMasonryCompressiveStrength(kFactor, brickStrength, mortarStrength);
		  const masonryCharacteristicStrengthRounded = Math.round(100*masonryCharacteristicStrength)/100;
		  const masonryDesignStrength = masonryCharacteristicStrength/1.7;
		  const masonryDesignStrengthRounded = Math.round(100*masonryDesignStrength)/100;

		  const structuralResistanceLoad = calculateStructuralResistanceLoad(load, windLoad, eccentricity, thickness, height, width, masonryCharacteristicStrength);
		  const structuralResistanceLoadRounded = Math.round(100*structuralResistanceLoad)/100;

		  document.getElementById("masonryCharacterisicStrength").innerHTML = `= ${masonryCharacteristicStrengthRounded} MPa`;
		  document.getElementById("masonryDesignStrength").innerHTML = `= ${masonryDesignStrengthRounded} MPa`;
		  document.getElementById("structuralResistanceLoad").innerHTML = `Kandevõime: ${structuralResistanceLoadRounded} kN`;
		}


		function visualize() {
			const canvas = document.getElementById('canvas');
			const ctx = canvas.getContext('2d');
			const cwidth = canvas.width;
			const cheight = canvas.height;

			const thickness = parseFloat(document.getElementById('thickness').value);
			const height = parseFloat(document.getElementById('height').value);
			const load = parseFloat(document.getElementById('load').value);
			const windLoad = parseFloat(document.getElementById('windLoad').value);
			const eccentricity = parseFloat(document.getElementById('eccentricity').value);



			// Clear canvas
			ctx.clearRect(0, 0, cwidth, cheight);
			// Set the line width and color
			ctx.lineWidth = 1;
			ctx.strokeStyle = "Black";


			// Draw wall
			ctx.beginPath();
			ctx.moveTo(cwidth/2, cheight-50);
			ctx.lineTo(cwidth/2, cheight - height * 100 - 50);
			ctx.lineTo(cwidth/2 + thickness * 100, cheight - height * 100 - 50);
			ctx.lineTo(cwidth/2 + thickness * 100, cheight - 50);
			ctx.stroke();

			// Draw load arrow
			ctx.beginPath();
			ctx.moveTo(cwidth/2 + (thickness/2 + eccentricity)*100, cheight - height * 100 - 50 - 0.5*load-20);
			ctx.lineTo(cwidth/2 + (thickness/2 + eccentricity)*100, cheight - height * 100 - 50);
			ctx.lineTo(cwidth/2 + (thickness/2 + eccentricity)*100 + 5, cheight - height * 100 - 50 - 10);
			ctx.moveTo(cwidth/2 + (thickness/2 + eccentricity)*100, cheight - height * 100 - 50);
			ctx.lineTo(cwidth/2 + (thickness/2 + eccentricity)*100 - 5, cheight - height * 100 - 50 - 10);
			ctx.stroke();



			// Calculate bending moments
			const mEdTop = calculateMomentFromLoad(load, eccentricity); // Bending moment at the top of the wall in kNm
			const mEdWind = calculateMomentFromWindLoad(windLoad, height); // Maximum bending moment from the wind load
			const mEdMid = 0.5 * mEdTop + mEdWind; // Bending moment at the center of the wall in kNm


			// Set the start and end points of the diagram
			const startX = cwidth/2 + thickness*100 + 50;
			const startY = cheight - height * 100 - 50;
			const endX = cwidth/2 + thickness*100 + 50;
			const endY = cheight - 50;

			// Set the control point of the curve
			const quadStartX = startX - mEdTop*10;
			const quadStartY = startY;
			const quadControlX = startX - mEdMid*10;
			const quadControlY = (startY + endY)/2;



			// Set the line width and color
			ctx.lineWidth = 2;
			ctx.strokeStyle = "red";

			// Draw the curve
			ctx.beginPath();
			ctx.moveTo(startX, startY);
			ctx.lineTo(quadStartX, quadStartY);
			ctx.quadraticCurveTo(quadControlX, quadControlY, endX, endY);
			ctx.lineTo(startX, startY);
			ctx.stroke();

			ctx.font = "12px Arial";
			ctx.fillText(Math.round((0.6 * mEdTop + mEdWind)*100)/100, startX, (quadControlY-10*height));
			ctx.fillText(Math.round(mEdTop*100)/100, startX, quadStartY);

		}


		function updateAll() {
			updateResult();
			visualize();
		}

	</script>

	<style>
		/* General styling */
		body {
			font-family: Arial, sans-serif;
			background-color: #fcfcfc;
		}
		h1 {
			text-align: left;
			font-size: 1.5rem;
			margin-top: 50px;
		}
		form {
			grid-gap: 20px;
			margin-top: 30px;
		}
		label {
			display: block;
			margin-top: 10px;
			margin-bottom: 5px;
		}
		input[type="number"] {
			text-align: center;
			padding: 5px;
			border: none;
			border-radius: 5px;
			box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.2);
		}
		input[type="submit"] {
			padding: 10px 20px;
			background-color: #4CAF50;
			color: #fff;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}
		input[type="submit"]:hover {
			background-color: #3e8e41;
		}
		.resultText {
			margin-top: 30px;
			font-size: 1.2rem;
			font-weight: bold;
		}
		.calculationResult {
			margin-top: 30px;
			font-size: 1.2rem;
			font-style: italic;
		}
		.vahetulemused {
			margin-top: 20px;
			font-size: 1rem;
			font-weight: bold;
			font-style: italic;
		}
		canvas {
			border: 1px solid black;
		}
		.content-flex {
			display: flex;
			flex-direction: row;
			flex-wrap: wrap;
			align-items: flex-start;
			width: calc(100% - 30px);
			padding: 0 15px;
		}
	</style>
</head>



<body onload="updateAll()">
	<h1>Müüritise kandevõime</h1>
	<div class="content-flex">
		<div>
			<label for="load">Arvutuslik koormus (kN):</label>
			<input type="number" id="load" name="load" value="30" onkeyup="updateAll()">
			<br>

			<label for="windLoad">Arvutuslik lauskoormus (kN/m):</label>
			<input type="number" id="windLoad" name="windLoad" value="1" onkeyup="updateAll()">
			<br>

			<label for="eccentricity">Koormuse ekstsentrilisus (m):</label>
			<input type="number" id="eccentricity" name="eccentricity" value="0.05" onkeyup="updateAll()">
			<br>

			<label for="thickness">Müüritise paksus (m):</label>
			<input type="number" id="thickness" name="thickness" value="0.2" onkeyup="updateAll()">
			<br>

			<label for="height">Müüritise kõrgus (m):</label>
			<input type="number" id="height" name="height" value="3" onkeyup="updateAll()">
			<br>

			<label for="width">Müüritise laius (m):</label>
			<input type="number" id="width" name="width" value="1" onkeyup="updateAll()">
			<br>

			<label for="brick-strength">Müürikivi normaliseeritud tugevus (MPa):</label>
			<input type="number" id="brick-strength" name="brick-strength" value="10" onkeyup="updateAll()">
			<br>

			<label for="mortar-strength">Mördi normatiivne tugevus (MPa):</label>
			<input type="number" id="mortar-strength" name="mortar-strength" value="5" onkeyup="updateAll()">
			<br>

			<label for="k-factor">K tegur:</label>
			<input type="number" id="k-factor" name="k-factor" value="0.55" onkeyup="updateAll()">
			
			<p class="resultText">Müüritise survetugevus:</p>
			<p>\[f_k = {K \cdot f_b^{0.7} \cdot f_m^{0.3}}\]</p>
			<div class="calculationResult" id="masonryCharacterisicStrength"></div>
			<p>\[f_d = {\frac{f_k}{\gamma_M}}\]</p>
			<div class="calculationResult" id="masonryDesignStrength"></div>

			<br>
			<div class="vahetulemused" id="vahetulemused"></div>

			<br>
			<div class="resultText" id="structuralResistanceLoad"></div>
		</div>

		<canvas id="canvas" width="400" height="600">Wall sketch should be here.</canvas>

	</div>


</body>
</html>